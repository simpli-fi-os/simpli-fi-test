<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- Open Graph / Social Sharing -->
    <meta property="og:title" content="Simpli-FI ID" id="og-title">
    <meta property="og:description" content="Connect with me." id="og-desc">
    <meta property="og:image" content="https://raw.githubusercontent.com/simpli-fi-os/simpli-fi-id/d59a8cb075df62d56e3ba6549131ae6cd773dbb1/ID.png" id="og-image">
    
    <!-- Favicons -->
    <link rel="icon" href="https://raw.githubusercontent.com/simpli-fi-os/simpli-fi-id/d59a8cb075df62d56e3ba6549131ae6cd773dbb1/ID.png" id="dynamic-favicon">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/simpli-fi-os/simpli-fi-id/d59a8cb075df62d56e3ba6549131ae6cd773dbb1/ID.png" id="dynamic-apple-icon">

    <title>Simpli-FI ID | Loading...</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Firebase SDKs (Compat 11.6.1) -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>

    <style>
        :root {
            --brand-primary: #1e293b;
            --brand-accent: #fbbf24;
        }
        body { background-color: #FBF9F7; overflow: hidden; touch-action: none; }
        .physics-element { position: absolute; pointer-events: none; z-index: 0; }
        
        #loader { display: flex; }
        #error-screen { display: none; }
        
        /* Smooth transitions for view switching */
        #card-container {
            transition: transform 0.1s ease-out; /* Fast response for zoom */
            transform-origin: center center;
        }

        /* View Modes */
        .view-simple .full-content { display: none; }
        .view-full .simple-content { display: none; }
        .view-full { height: 100%; }

        /* Neumorphic Toggle Button */
        #toggle-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #FBF9F7;
            box-shadow: 8px 8px 16px #D6D3CD, -8px -8px 16px #FFFFFF;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            border: none;
        }
        #toggle-btn:hover {
            transform: scale(1.1);
            box-shadow: 4px 4px 8px #D6D3CD, -4px -4px 8px #FFFFFF;
        }
        #toggle-btn:active {
            box-shadow: inset 4px 4px 8px #D6D3CD, inset -4px -4px 8px #FFFFFF;
            transform: scale(0.95);
        }
        
        /* Hide scrollbar for internal content */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="fixed inset-0 flex items-center justify-center bg-stone-100">

    <!-- Physics Layer -->
    <div id="physics-layer" class="absolute inset-0 pointer-events-none overflow-hidden z-0"></div>

    <!-- Loader -->
    <div id="loader" class="fixed inset-0 bg-slate-900 flex items-center justify-center z-50 transition-opacity duration-500">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#fbbf24]"></div>
    </div>

    <!-- Error Screen -->
    <div id="error-screen" class="fixed inset-0 bg-slate-900 z-[60] flex flex-col items-center justify-center p-8 text-center hidden">
        <div class="w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mb-4 text-red-500">
            <i data-lucide="alert-triangle" class="w-8 h-8"></i>
        </div>
        <h2 class="text-white font-bold text-xl mb-2">System Error</h2>
        <p id="error-message" class="text-slate-400 text-sm mb-6">Unable to load identity.</p>
        <button onclick="window.location.reload()" class="px-6 py-3 bg-white text-slate-900 font-bold rounded-xl text-sm">Retry Connection</button>
    </div>

    <!-- Main Card Container (Zoom Target) -->
    <div id="zoom-wrapper" class="w-full h-full flex items-center justify-center overflow-hidden relative z-10">
        <main id="card-container" class="w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden border border-slate-200 relative flex flex-col transition-all duration-500 view-simple h-auto max-h-[85vh]">
            
            <!-- HEADER (Shared) -->
            <div class="h-32 relative overflow-hidden shrink-0" id="header-bg" style="background-color: var(--brand-primary);">
                <div class="absolute top-4 right-4 z-20 bg-white/20 backdrop-blur p-1.5 rounded-lg cursor-pointer hover:bg-white/30 transition" onclick="toggleQR()">
                    <i data-lucide="qr-code" class="w-4 h-4 text-white"></i>
                </div>
                <div class="absolute top-4 left-4 z-10 flex items-center gap-3">
                    <div id="org-logo" class="w-10 h-10 bg-white/10 backdrop-blur-md rounded-lg flex items-center justify-center text-white font-bold text-lg">S</div>
                    <span class="font-serif text-white font-bold tracking-tight text-sm opacity-90" id="org-name">Simpli-FI</span>
                </div>
                <div class="absolute inset-0 opacity-20 bg-[radial-gradient(var(--brand-accent)_1px,transparent_1px)] [background-size:14px_14px]"></div>
            </div>

            <!-- CONTENT: SIMPLE VIEW -->
            <div class="simple-content flex flex-col p-6 text-center">
                <div class="inline-block relative -mt-16 mb-4 mx-auto">
                    <div class="w-32 h-32 rounded-full border-4 border-white shadow-lg overflow-hidden bg-slate-100">
                        <img id="avatar-simple" src="" class="w-full h-full object-cover">
                    </div>
                </div>
                <h1 id="user-name-simple" class="font-serif text-3xl font-bold" style="color: var(--brand-primary);">User Name</h1>
                <p id="user-title-simple" class="font-bold text-xs tracking-widest uppercase mt-1 mb-6" style="color: var(--brand-accent);">Title</p>
                
                <!-- Quick Actions Grid -->
                <div id="actions-grid" class="grid grid-cols-4 gap-2 mb-6"></div>

                <div class="mt-auto pt-4 border-t border-slate-100">
                     <button onclick="downloadVCard()" class="w-full py-3 rounded-xl bg-slate-900 text-white font-bold text-sm shadow-md hover:bg-slate-800 transition flex items-center justify-center gap-2">
                        <span>Save Contact</span>
                    </button>
                </div>
            </div>

            <!-- CONTENT: FULL VIEW (Scrollable) -->
            <div class="full-content flex flex-col h-full overflow-hidden">
                <div class="flex-1 overflow-y-auto no-scrollbar p-6 pt-0">
                    <div class="text-center -mt-16 mb-6 relative z-10 pointer-events-none">
                         <div class="w-32 h-32 rounded-full border-4 border-white shadow-lg overflow-hidden bg-slate-100 mx-auto">
                            <img id="avatar-full" src="" class="w-full h-full object-cover">
                        </div>
                    </div>
                    
                    <div class="text-center mb-8">
                        <h1 id="user-name-full" class="font-serif text-3xl font-bold" style="color: var(--brand-primary);">User Name</h1>
                        <p id="user-title-full" class="font-bold text-xs tracking-widest uppercase mt-1" style="color: var(--brand-accent);">Title</p>
                    </div>

                    <!-- Mission -->
                    <div class="mb-6">
                        <div class="bg-slate-50 p-4 rounded-xl border-l-4 overflow-hidden relative" style="border-color: var(--brand-primary);">
                             <div class="flex items-center gap-2 mb-2">
                                <i data-lucide="target" class="w-3 h-3" style="color: var(--brand-primary);"></i>
                                <h3 class="text-[10px] font-bold uppercase tracking-widest" style="color: var(--brand-primary);">Mission</h3>
                            </div>
                            <p id="mission-text" class="text-slate-700 text-sm font-medium italic leading-relaxed">Loading...</p>
                        </div>
                    </div>

                    <!-- Bio -->
                    <div class="mb-6 px-2">
                        <h3 class="text-xs font-bold uppercase tracking-wider mb-2" style="color: var(--brand-accent);">About</h3>
                        <p id="bio-text" class="text-slate-600 text-sm leading-relaxed font-light"></p>
                    </div>

                    <!-- Details List -->
                    <div id="contact-details-list" class="space-y-3 mb-8"></div>
                    
                    <!-- Socials -->
                    <div class="flex justify-center gap-4 py-4 border-t border-slate-100">
                        <!-- Injected JS -->
                    </div>
                </div>
                
                <!-- Sticky Save Button -->
                <div class="p-6 pt-2 bg-white border-t border-slate-100">
                    <button onclick="downloadVCard()" class="w-full py-3 rounded-xl bg-slate-900 text-white font-bold text-sm shadow-md hover:bg-slate-800 transition flex items-center justify-center gap-2">
                        <span>Save to Contacts</span>
                    </button>
                </div>
            </div>

            <!-- FOOTER BRANDING -->
            <div class="py-3 text-center bg-slate-50 border-t border-slate-200">
                <a href="https://simpli-fi-os.com" target="_blank" class="text-[10px] text-slate-400 font-bold tracking-widest uppercase hover:text-slate-600 transition">
                    Powered by Simpli-FI
                </a>
            </div>
        </main>
    </div>

    <!-- Toggle FAB -->
    <button id="toggle-btn" onclick="toggleView()">
        <i id="toggle-icon" data-lucide="plus" class="w-6 h-6 text-slate-700"></i>
    </button>

    <!-- QR Modal -->
    <div id="qrModal" class="hidden fixed inset-0 z-[70] flex items-center justify-center p-4 bg-slate-900/90 backdrop-blur-sm" onclick="toggleQR()">
        <div class="bg-white p-6 rounded-3xl shadow-2xl max-w-sm w-full text-center scale-95" onclick="event.stopPropagation()">
            <div class="mb-4">
                 <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://simpli-fi-os.com" alt="QR" class="w-full h-auto rounded-xl">
            </div>
            <p class="text-xs font-bold text-slate-500 uppercase tracking-widest">Scan to Connect</p>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyAnlmGZNwoPS-vBnK1AlHvNsB73q0UAkCU",
            authDomain: "simpli-fi-id.firebaseapp.com",
            projectId: "simpli-fi-id",
            storageBucket: "simpli-fi-id.firebasestorage.app",
            messagingSenderId: "97006103916",
            appId: "1:97006103916:web:631c876a6eb263caf81749"
        };
        
        let db, auth, userData;
        let isFullView = false;
        let scale = 1;

        // --- INIT ---
        async function init() {
            try {
                if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                await auth.signInAnonymously();
                
                // Simulate Data Fetch
                userData = {
                    full_name: "Lindsey Lott",
                    title: "Founder & Lead Organizer",
                    bio: "Pediatric Nurse turned organization expert. Helping families eliminate chaos.",
                    mission: "Connecting 20 new business owners in the next 60 days.",
                    phone: "214-769-3343",
                    email: "Lindsey@simpli-fi-life.com",
                    website: "simpli-fi-life.com",
                    avatar_url: "https://raw.githubusercontent.com/simpli-fi-os/assets/abc740cc26a619c8153bbfeafbcb85c23879fcdf/lindsey-lott.jpg"
                };
                
                renderCard();
                initZoom();
                lucide.createIcons();
                
                document.getElementById('loader').classList.add('opacity-0');
                setTimeout(() => document.getElementById('loader').style.display = 'none', 500);

            } catch (e) {
                console.error(e);
                document.getElementById('loader').style.display = 'none';
                document.getElementById('error-screen').style.display = 'flex';
            }
        }

        // --- RENDER ---
        function renderCard() {
            const els = {
                nameS: document.getElementById('user-name-simple'),
                nameF: document.getElementById('user-name-full'),
                titleS: document.getElementById('user-title-simple'),
                titleF: document.getElementById('user-title-full'),
                avS: document.getElementById('avatar-simple'),
                avF: document.getElementById('avatar-full'),
                bio: document.getElementById('bio-text'),
                mission: document.getElementById('mission-text')
            };

            els.nameS.innerText = els.nameF.innerText = userData.full_name;
            els.titleS.innerText = els.titleF.innerText = userData.title;
            els.avS.src = els.avF.src = userData.avatar_url;
            els.bio.innerText = userData.bio;
            els.mission.innerText = userData.mission;

            // Render Actions
            const actions = [
                { icon: 'phone', label: 'Call', action: `tel:${userData.phone}` },
                { icon: 'mail', label: 'Email', action: `mailto:${userData.email}` },
                { icon: 'globe', label: 'Site', action: `https://${userData.website}` },
                { icon: 'contact', label: 'Save', action: `javascript:downloadVCard()` }
            ];
            
            const grid = document.getElementById('actions-grid');
            grid.innerHTML = actions.map(a => `
                <a href="${a.action}" class="flex flex-col items-center gap-1 group">
                    <div class="w-12 h-12 rounded-2xl bg-slate-50 flex items-center justify-center text-slate-600 shadow-sm border border-slate-200 group-hover:bg-[#1e293b] group-hover:text-white transition">
                        <i data-lucide="${a.icon}" class="w-5 h-5"></i>
                    </div>
                    <span class="text-[10px] text-slate-500 font-medium">${a.label}</span>
                </a>
            `).join('');

            // Render Details List
            const list = document.getElementById('contact-details-list');
            list.innerHTML = `
                <div class="flex items-center p-3 rounded-xl bg-slate-50 border border-slate-100">
                    <i data-lucide="smartphone" class="w-4 h-4 text-slate-400 mr-3"></i>
                    <span class="text-xs text-slate-700">${userData.phone}</span>
                </div>
                <div class="flex items-center p-3 rounded-xl bg-slate-50 border border-slate-100">
                    <i data-lucide="mail" class="w-4 h-4 text-slate-400 mr-3"></i>
                    <span class="text-xs text-slate-700">${userData.email}</span>
                </div>
            `;
        }

        // --- VIEW LOGIC ---
        function toggleView() {
            const card = document.getElementById('card-container');
            const icon = document.getElementById('toggle-icon');
            
            if (isFullView) {
                // Switch to Simple
                card.classList.remove('view-full');
                card.classList.add('view-simple');
                card.classList.remove('h-full');
                card.classList.add('h-auto');
                
                // Update Icon to Plus
                icon.innerHTML = '<line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line>'; // Lucide Plus SVG content manually for speed
                // Or just re-render: icon.setAttribute('data-lucide', 'plus'); lucide.createIcons();
                
            } else {
                // Switch to Full
                card.classList.remove('view-simple');
                card.classList.add('view-full');
                card.classList.remove('h-auto');
                card.classList.add('h-full');
                
                // Update Icon to Minus
                icon.innerHTML = '<line x1="5" y1="12" x2="19" y2="12"></line>'; // Lucide Minus
            }
            
            // Re-render icons just in case
            // lucide.createIcons(); // Can be expensive on animation, manual SVG replacement preferred above
            
            isFullView = !isFullView;
        }

        // --- ZOOM LOGIC ---
        function initZoom() {
            const wrapper = document.getElementById('zoom-wrapper');
            const card = document.getElementById('card-container');
            
            // Mouse Wheel
            wrapper.addEventListener('wheel', (e) => {
                if (e.ctrlKey || e.metaKey) { // Only zoom if holding ctrl (standard browser behavior check, or just always)
                    e.preventDefault();
                    const delta = e.deltaY * -0.001;
                    applyScale(delta);
                }
            });

            // Touch Pinch
            let initialDist = 0;
            wrapper.addEventListener('touchstart', (e) => {
                if (e.touches.length === 2) {
                    initialDist = Math.hypot(
                        e.touches[0].pageX - e.touches[1].pageX,
                        e.touches[0].pageY - e.touches[1].pageY
                    );
                }
            });

            wrapper.addEventListener('touchmove', (e) => {
                if (e.touches.length === 2) {
                    e.preventDefault();
                    const dist = Math.hypot(
                        e.touches[0].pageX - e.touches[1].pageX,
                        e.touches[0].pageY - e.touches[1].pageY
                    );
                    const delta = (dist - initialDist) * 0.005;
                    applyScale(delta);
                    initialDist = dist; // Reset for continuous smooth zoom
                }
            });
        }

        function applyScale(delta) {
            scale = Math.min(Math.max(0.7, scale + delta), 1.5); // Clamp 0.7x to 1.5x
            document.getElementById('card-container').style.transform = `scale(${scale})`;
        }

        function toggleQR() {
            const m = document.getElementById('qrModal');
            m.classList.toggle('hidden');
        }

        function downloadVCard() {
            alert("Downloading Contact...");
        }

        window.onload = init;
    </script>
</body>
</html>
