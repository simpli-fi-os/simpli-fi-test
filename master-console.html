<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simpli-FI ID | Master Console v3.7</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Dark Mode Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        .tree-line {
            border-left: 1px dashed #334155;
            margin-left: 0.5rem;
            padding-left: 1rem;
        }
       
        .tree-item {
            cursor: pointer;
            transition: all 0.15s ease;
            border-radius: 4px;
        }
        .tree-item:hover { background: rgba(59, 130, 246, 0.1); }
        .tree-item.active { background: rgba(251, 191, 36, 0.1); color: #fbbf24; }
       
        pre code {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 13px;
            line-height: 1.6;
        }
    </style>
</head>
<body class="bg-[#0f172a] text-slate-300 h-screen flex flex-col overflow-hidden font-sans">
    <!-- TOP BAR -->
    <header class="h-14 border-b border-slate-700 bg-[#0f172a] flex items-center justify-between px-4 shrink-0 z-20">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-[#fbbf24] text-[#0f172a] rounded flex items-center justify-center font-bold font-mono shadow-[0_0_15px_rgba(251,191,36,0.2)]">ID</div>
            <div>
                <h1 class="font-bold text-sm text-white tracking-tight leading-tight">Simpli-FI Master Console</h1>
                <p class="text-[10px] text-slate-400 font-mono">Series A Protocol // <span class="text-emerald-400">GOLDEN</span></p>
            </div>
        </div>
        <button onclick="copyCurrentFile()" class="bg-slate-800 hover:bg-slate-700 text-xs text-white px-3 py-1.5 rounded border border-slate-600 flex items-center gap-2 transition">
            <i data-lucide="copy" class="w-3 h-3"></i> Copy Code
        </button>
    </header>
    <!-- MAIN WORKSPACE -->
    <div class="flex-1 flex overflow-hidden">
       
        <!-- SIDEBAR (FILE TREE) -->
        <aside class="w-72 bg-[#1e293b]/50 border-r border-slate-700 flex flex-col">
            <div class="p-3 border-b border-slate-700/50">
                <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Project Root</span>
            </div>
           
            <div class="flex-1 overflow-y-auto p-2 text-sm select-none">
               
                <!-- 0. DOCUMENTATION -->
                <div class="mb-2">
                    <div class="flex items-center gap-2 px-2 py-1 text-slate-100 font-bold"><i data-lucide="book" class="w-4 h-4 text-purple-400"></i> docs/</div>
                    <div class="tree-line">
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('doc_mvp', this)"><i data-lucide="file-text" class="w-3 h-3 text-purple-300"></i> mvp_launch_checklist.md <span class="text-[8px] bg-red-500/20 text-red-300 px-1 rounded ml-auto">CRITICAL</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('doc_series_a', this)"><i data-lucide="file-text" class="w-3 h-3 text-purple-300"></i> series_a_roadmap.md <span class="text-[8px] bg-slate-700 text-slate-300 px-1 rounded ml-auto">FUTURE</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('doc_project_brief', this)"><i data-lucide="file-text" class="w-3 h-3 text-purple-300"></i> project_brief.md <span class="text-[8px] bg-blue-500/20 text-blue-300 px-1 rounded ml-auto">OVERVIEW</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('doc_feature_matrix', this)"><i data-lucide="file-text" class="w-3 h-3 text-purple-300"></i> feature_matrix.md <span class="text-[8px] bg-yellow-500/20 text-yellow-300 px-1 rounded ml-auto">TIERS</span></div>
                    </div>
                </div>

                <!-- 1. AIRLOCK (BACKEND) -->
                <div class="mb-2">
                    <div class="flex items-center gap-2 px-2 py-1 text-slate-100 font-bold"><i data-lucide="folder" class="w-4 h-4 text-blue-400"></i> airlock/</div>
                    <div class="tree-line">
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('airlock_package', this)"><i data-lucide="file-json" class="w-3 h-3 text-emerald-400"></i> package.json <span class="text-[8px] bg-emerald-500/20 text-emerald-300 px-1 rounded ml-auto">MVP</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('airlock_lock', this)"><i data-lucide="lock" class="w-3 h-3 text-slate-500"></i> package-lock.json <span class="text-[8px] bg-slate-700 text-slate-300 px-1 rounded ml-auto">KEEP</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('airlock_index', this)"><i data-lucide="file-code" class="w-3 h-3 text-yellow-500"></i> index.js <span class="text-[8px] bg-cyan-500/20 text-cyan-300 px-1 rounded ml-auto">FAST</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('airlock_docker', this)"><i data-lucide="container" class="w-3 h-3 text-blue-300"></i> Dockerfile <span class="text-[8px] bg-emerald-500/20 text-emerald-300 px-1 rounded ml-auto">PROD</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('airlock_dockerignore', this)"><i data-lucide="ban" class="w-3 h-3 text-red-400"></i> .dockerignore <span class="text-[8px] bg-red-500/20 text-red-300 px-1 rounded ml-auto">SECURE</span></div>
                        <div class="mt-2 flex items-center gap-2 px-2 py-1 text-slate-300"><i data-lucide="folder-open" class="w-3 h-3 text-blue-300"></i> routes/</div>
                        <div class="tree-line">
                            <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('airlock_routes_claim', this)"><i data-lucide="route" class="w-3 h-3 text-cyan-400"></i> claim.js <span class="text-[8px] bg-purple-500/20 text-purple-300 px-1 rounded ml-auto">TRACKING</span></div>
                        </div>
                    </div>
                </div>

                <!-- 2. FUNCTIONS (BACKGROUND TASKS) -->
                <div class="mb-2">
                    <div class="flex items-center gap-2 px-2 py-1 text-slate-100 font-bold"><i data-lucide="folder" class="w-4 h-4 text-purple-400"></i> functions/</div>
                    <div class="tree-line">
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('functions_package', this)"><i data-lucide="file-json" class="w-3 h-3 text-slate-400"></i> package.json <span class="text-[8px] bg-purple-500/20 text-purple-300 px-1 rounded ml-auto">CF</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('functions_lock', this)"><i data-lucide="lock" class="w-3 h-3 text-slate-500"></i> package-lock.json <span class="text-[8px] bg-slate-700 text-slate-300 px-1 rounded ml-auto">LOCKED</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('functions_index', this)"><i data-lucide="file-code" class="w-3 h-3 text-yellow-500"></i> index.js <span class="text-[8px] bg-emerald-500/20 text-emerald-300 px-1 rounded ml-auto">SYNC</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('functions_email', this)"><i data-lucide="mail" class="w-3 h-3 text-emerald-400"></i> sendWelcomeEmail.js <span class="text-[8px] bg-teal-500/20 text-teal-300 px-1 rounded ml-auto">EMAIL</span></div>
                    </div>
                </div>

                <!-- 3. SRC (FRONTEND LOGIC) -->
                <div class="mb-2">
                    <div class="flex items-center gap-2 px-2 py-1 text-slate-100 font-bold"><i data-lucide="folder" class="w-4 h-4 text-orange-400"></i> src/</div>
                    <div class="tree-line">
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('src_utils', this)"><i data-lucide="wrench" class="w-3 h-3 text-orange-300"></i> utils.js <span class="text-[8px] bg-orange-500/20 text-orange-300 px-1 rounded ml-auto">TOOLS</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('src_confetti', this)"><i data-lucide="party-popper" class="w-3 h-3 text-yellow-400"></i> confettiManager.js <span class="text-[8px] bg-yellow-500/20 text-yellow-300 px-1 rounded ml-auto">PARTY</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('src_vcard', this)"><i data-lucide="contact" class="w-3 h-3 text-teal-400"></i> vcardGenerator.js <span class="text-[8px] bg-teal-500/20 text-teal-300 px-1 rounded ml-auto">CONTACT</span></div>
                    </div>
                </div>

                <!-- 4. SCRIPTS (DEPLOYMENT) -->
                <div class="mb-2">
                    <div class="flex items-center gap-2 px-2 py-1 text-slate-100 font-bold"><i data-lucide="folder" class="w-4 h-4 text-indigo-400"></i> scripts/</div>
                    <div class="tree-line">
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('scripts_deploy', this)"><i data-lucide="rocket" class="w-3 h-3 text-indigo-300"></i> deploy-hosting.sh <span class="text-[8px] bg-indigo-500/20 text-indigo-300 px-1 rounded ml-auto">LIVE</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('scripts_env', this)"><i data-lucide="settings" class="w-3 h-3 text-indigo-300"></i> setup-env.js <span class="text-[8px] bg-indigo-500/20 text-indigo-300 px-1 rounded ml-auto">INIT</span></div>
                    </div>
                </div>

                <!-- 5. SECURITY -->
                <div class="mb-2">
                    <div class="flex items-center gap-2 px-2 py-1 text-slate-100 font-bold"><i data-lucide="shield-alert" class="w-4 h-4 text-emerald-400"></i> Security</div>
                    <div class="tree-line">
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('firestore_rules', this)"><i data-lucide="database" class="w-3 h-3 text-emerald-400"></i> firestore.rules <span class="text-[8px] bg-emerald-500/20 text-emerald-300 px-1 rounded ml-auto">READY</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('storage_rules', this)"><i data-lucide="hard-drive" class="w-3 h-3 text-emerald-400"></i> storage.rules <span class="text-[8px] bg-emerald-500/20 text-emerald-300 px-1 rounded ml-auto">SECURE</span></div>
                    </div>
                </div>

                <!-- 6. PUBLIC (FRONTEND) -->
                <div class="mb-2">
                    <div class="flex items-center gap-2 px-2 py-1 text-slate-100 font-bold"><i data-lucide="folder" class="w-4 h-4 text-blue-400"></i> public/</div>
                    <div class="tree-line">
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('public_index', this)"><i data-lucide="layout" class="w-3 h-3 text-orange-400"></i> index.html <span class="text-[8px] bg-orange-500/20 text-orange-300 px-1 rounded ml-auto">LIVE</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('public_card', this)"><i data-lucide="smartphone" class="w-3 h-3 text-orange-400"></i> card.html <span class="text-[8px] bg-orange-500/20 text-orange-300 px-1 rounded ml-auto">LIVE</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('public_intake', this)"><i data-lucide="file-input" class="w-3 h-3 text-orange-400"></i> intake_form.html <span class="text-[8px] bg-orange-500/20 text-orange-300 px-1 rounded ml-auto">ELITE</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('public_setup', this)"><i data-lucide="settings" class="w-3 h-3 text-orange-400"></i> enterprise_setup.html <span class="text-[8px] bg-orange-500/20 text-orange-300 px-1 rounded ml-auto">LOADED</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('public_admin', this)"><i data-lucide="shield" class="w-3 h-3 text-orange-400"></i> admin_dashboard.html <span class="text-[8px] bg-orange-500/20 text-orange-300 px-1 rounded ml-auto">LOADED</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('public_catalog', this)"><i data-lucide="library" class="w-3 h-3 text-orange-400"></i> resource_catalog.html <span class="text-[8px] bg-orange-500/20 text-orange-300 px-1 rounded ml-auto">LIVE</span></div>
                        <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('public_ops', this)"><i data-lucide="activity" class="w-3 h-3 text-orange-400"></i> ops_center.html <span class="text-[8px] bg-orange-500/20 text-orange-300 px-1 rounded ml-auto">LIVE</span></div>
                    </div>
                </div>

                <!-- 7. ROOT FILES -->
                <div class="mt-2">
                    <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('readme', this)"><i data-lucide="file-text" class="w-3 h-3 text-blue-300"></i> README.md <span class="text-[8px] bg-blue-500/20 text-blue-300 px-1 rounded ml-auto">UPDATED</span></div>
                    <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('firebaserc', this)"><i data-lucide="target" class="w-3 h-3 text-slate-400"></i> .firebaserc <span class="text-[8px] bg-slate-700 text-slate-300 px-1 rounded ml-auto">CONFIG</span></div>
                    <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('firebase_json', this)"><i data-lucide="settings" class="w-3 h-3 text-slate-400"></i> firebase.json <span class="text-[8px] bg-slate-700 text-slate-300 px-1 rounded ml-auto">ROUTES</span></div>
                    <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('gitignore', this)"><i data-lucide="eye-off" class="w-3 h-3 text-slate-500"></i> .gitignore <span class="text-[8px] bg-slate-700 text-slate-300 px-1 rounded ml-auto">SAFE</span></div>
                    <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('env_example', this)"><i data-lucide="key" class="w-3 h-3 text-amber-400"></i> .env.example <span class="text-[8px] bg-amber-500/20 text-amber-300 px-1 rounded ml-auto">TEMPLATE</span></div>
                    <div class="tree-item flex items-center gap-2 px-2 py-1" onclick="load('tailwind_config', this)"><i data-lucide="palette" class="w-3 h-3 text-pink-400"></i> tailwind.config.js <span class="text-[8px] bg-pink-500/20 text-pink-300 px-1 rounded ml-auto">BRAND</span></div>
                </div>
            </div>
        </aside>

        <!-- EDITOR PANE -->
        <main class="flex-1 flex flex-col bg-[#0f172a] relative">
            <div class="absolute inset-0 overflow-auto">
                <div class="p-6 min-h-full">
                    <pre><code id="code-view" class="block text-slate-300">/* Select a file from the sidebar to inspect the source. */</code></pre>
                </div>
            </div>
            <div id="file-label" class="absolute bottom-4 right-6 bg-[#fbbf24] text-[#0f172a] text-xs font-bold px-3 py-1 rounded shadow-lg opacity-0 transition-opacity pointer-events-none">
                index.js
            </div>
        </main>
    </div>

    <!-- DATA STORE -->
    <script>
        const FILES = {
            doc_mvp: `# SIMPLI-FI ID: THE MVP LAUNCHPAD\n# (Checklist for Initial Release)\n\n## Pre-Launch (Week 1)\n- [ ] Finalize Firestore Schema\n- [ ] Deploy Airlock to Cloud Run\n- [ ] Test Intake Engine (Payments + Card Gen)\n- [ ] Load Test Redirects (1k Concurrent)\n- [ ] Notion CRM Integration\n\n## Launch Day (Jan 1, 2026)\n- [ ] Firebase Deploy All\n- [ ] Announce on X/LinkedIn\n- [ ] Monitor Ops Center\n\n## Post-Launch (Week 2+)\n- [ ] Gather Feedback\n- [ ] Iterate Card UI\n- [ ] Scale to $5k MRR`,

            doc_series_a: `# SIMPLI-FI ID: SERIES A MIGRATION PLAN\n\n## Q1 2026: Stabilize MVP\n- Achieve $5k MRR\n- 1k Active IDs\n- Add Enterprise Beta\n\n## Q2 2026: Scale Backend\n- Migrate Airlock to GCP Load Balancer\n- Add Redis Cache for Redirects\n- Implement Webhooks for Stripe\n\n## Q3 2026: Intelligence Suite\n- Heatmaps for Microsites\n- Lead Capture Forms\n- CRM Integrations\n\n## Q4 2026: $20M ARR Push\n- Global CDN for Cards\n- AI-Powered Analytics\n- Partner Program`,

            doc_project_brief: `# Project Brief: Simpli-FI ID\n\n## Vision\nReplace paper business cards with dynamic, trackable digital identities.\n\n## Key Features\n- Tiered Pricing (Free/Pro/Founder/Enterprise)\n- Automated Onboarding\n- Resource Sharing & Analytics\n- Enterprise Admin\n\n## Tech Stack\n- Frontend: Tailwind + Firebase Hosting\n- Backend: Cloud Functions + Cloud Run\n- DB: Firestore + Storage\n- CRM: Notion Sync\n\n## Goals\n$5k MRR in Q1\n$20M ARR by EOY`,

            doc_feature_matrix: `# Simpli-FI ID: Comprehensive Feature Matrix

| Feature | Ambassador (Free) | Professional ($19) | Founder ($49 + $5/mo) | Enterprise (Custom) |
|---------|-------------------|--------------------|-----------------------|---------------------|
| Mobile Card | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| Ad-Free | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| Save Contact | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| Custom Colors | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| Custom Domain | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Gold Badge | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Unlimited Updates | ‚ùå | 1/year | ‚úÖ | ‚úÖ |
| Commerce Link | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Resource Catalog | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Admin Dashboard | ‚ùå | ‚ùå | Personal | Full Team |
| Bulk Provisioning | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |
| Brand Lock | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |
| Priority Support | Standard | Standard | Email | Dedicated |
`,

            airlock_package: `{ "name": "airlock", "version": "1.0.0", "main": "index.js", "dependencies": { "express": "^4.18.2", "@google-cloud/firestore": "^7.1.0" }, "engines": { "node": "18" } }`,

            airlock_lock: `// Full package-lock.json content (truncated for brevity)\n// Use npm install to generate locally`,

            airlock_index: `/**
 * SIMPLI-FI AIRLOCK v2.0
 * Goal: <100ms Redirect Latency
 */
const express = require('express');
const { Firestore } = require('@google-cloud/firestore');
const app = express();

// Warm Start Optimization
const firestore = new Firestore();
const publicCards = firestore.collection('public_cards');

app.get('/:id', async (req, res) => {
    const start = Date.now();
    const id = req.params.id;

    try {
        const doc = await publicCards.doc(id).get();

        if (!doc.exists) {
            return res.status(404).send('Card not found');
        }

        const data = doc.data();
        const dest = data.redirect_url || \`https://id.simpli-fi-os.com/card/\${id}\`;

        logScan(id, req);

        res.set('X-Airlock-Latency', \`\${Date.now() - start}ms\`);
        res.redirect(302, dest);

    } catch (e) {
        console.error(e);
        res.redirect('https://simpli-fi-os.com/error');
    }
});

function logScan(id, req) {
    firestore.collection('events').add({
        type: 'scan',
        card_id: id,
        ip: req.ip,
        ua: req.get('User-Agent'),
        ts: Firestore.FieldValue.serverTimestamp()
    }).catch(console.error);
}

const PORT = process.env.PORT || 8080;
app.listen(PORT, () => console.log(\`Airlock active on port \${PORT}\`));`,

            airlock_docker: `# SERIES A STANDARD CONTAINER
FROM node:18-alpine as builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

FROM gcr.io/distroless/nodejs18-debian11
WORKDIR /app
COPY --from=builder /app/node_modules ./node_modules
COPY . .

ENV NODE_ENV=production
CMD ["index.js"]`,

            airlock_dockerignore: `# AIRLOCK DOCKER IGNORE
node_modules
npm-debug.log
.env
.DS_Store
Dockerfile
.dockerignore`,

            airlock_routes_claim: `/**
 * airlock/routes/claim.js
 * High-velocity resource claim endpoint
 */

const express = require('express');
const { Firestore } = require('@google-cloud/firestore');

const router = express.Router();
const firestore = new Firestore();

const resources = firestore.collection('resources');
const users = firestore.collection('users');
const events = firestore.collection('events');

router.get('/:resourceId', async (req, res) => {
    const start = Date.now();
    const { resourceId } = req.params;
    const referrerId = req.query.ref;

    try {
        const resourceDoc = await resources.doc(resourceId).get();

        if (!resourceDoc.exists) {
            return res.status(404).send('Resource not found');
        }

        const resourceData = resourceDoc.data();
        const destinationUrl = resourceData.url;

        if (referrerId) {
            const userDoc = await users.doc(referrerId).get();
            if (userDoc.exists) {
                incrementScoreAndLog(referrerId, resourceId, req);
            }
        }

        res.set('X-Airlock-Latency', \`\${Date.now() - start}ms\`);
        res.redirect(302, destinationUrl);

    } catch (error) {
        console.error('Claim route error:', error);
        res.redirect('https://simpli-fi-os.com/error');
    }
});

async function incrementScoreAndLog(userId, resourceId, req) {
    const batch = firestore.batch();

    const userRef = users.doc(userId);
    batch.update(userRef, {
        score: Firestore.FieldValue.increment(1),
        last_active: Firestore.FieldValue.serverTimestamp()
    });

    const eventRef = events.doc();
    batch.set(eventRef, {
        type: 'resource_scan',
        user_id: userId,
        resource_id: resourceId,
        ip: req.ip,
        user_agent: req.get('User-Agent'),
        timestamp: Firestore.FieldValue.serverTimestamp()
    });

    batch.commit().catch(err => console.error('Batch commit failed:', err));
}

module.exports = router;`,

            functions_package: `{ "name": "functions", "description": "Cloud Functions for Simpli-FI OS", "scripts": { "lint": "eslint", "serve": "firebase emulators:start --only functions", "shell": "firebase functions:shell", "start": "npm run shell", "deploy": "firebase deploy --only functions", "logs": "firebase functions:log" }, "main": "index.js", "dependencies": { "@notionhq/client": "^2.2.13", "firebase-admin": "^13.6.0", "firebase-functions": "^7.0.2" }, "devDependencies": { "eslint": "^8.9.0", "eslint-config-google": "^0.14.0" }, "private": true }`,

            functions_lock: `// Full functions package-lock.json\n// Run npm install to generate locally`,

            functions_index: `/**
 * SIMPLI-FI BACKGROUND TASKS (Cloud Functions)
 */
const functions = require('firebase-functions');
const admin = require('firebase-admin');
const { Client } = require('@notionhq/client');

admin.initializeApp();

const notionKey = functions.config().notion?.key;
const notionDbId = functions.config().notion?.db_id;

let notion;
if (notionKey) {
    notion = new Client({ auth: notionKey });
}

exports.syncToNotion = functions.firestore
    .document('users/{userId}')
    .onCreate(async (snap, context) => {
        if (!notion) {
            console.warn("Notion Sync Skipped: No API Key configured.");
            return null;
        }

        const userData = snap.data();
        const userId = context.params.userId;

        if (!userData.full_name) {
            console.warn(\`Skipped \${userId}: Missing full_name\`);
            return null;
        }

        let startDate = new Date().toISOString();
        if (userData.created_at && typeof userData.created_at.toDate === 'function') {
            startDate = userData.created_at.toDate().toISOString();
        }

        const tierValue = (userData.tier || "free").toLowerCase(); 

        try {
            await notion.pages.create({
                parent: { database_id: notionDbId },
                properties: {
                    "Name": { title: [{ text: { content: userData.full_name || "Unknown" } }] },
                    "Email": { email: userData.email || "" },
                    "Phone": { phone_number: userData.phone || "" },
                    "Status": { select: { name: "New Lead" } },
                    "Tier": { select: { name: tierValue } },
                    "Card URL": { url: \`https://id.simpli-fi-os.com/\${userId}\` },
                    "Start Date": { date: { start: startDate } }
                }
            });
            console.log(\`Synced \${userId} successfully.\`);
            return null;
        } catch (error) {
            console.error("Notion Sync Failed:", error.message);
            return null;
        }
    });`,

            functions_email: `/**
 * functions/sendWelcomeEmail.js
 * Transactional welcome email + vCard attachment
 */

const functions = require('firebase-functions');
const admin = require('firebase-admin');
const sgMail = require('@sendgrid/mail');

const SENDGRID_KEY = functions.config().sendgrid?.key;
const TEMPLATE_ID = functions.config().sendgrid?.template_id;

if (SENDGRID_KEY) {
    sgMail.setApiKey(SENDGRID_KEY);
}

exports.sendWelcomeEmail = functions.firestore
    .document('users/{userId}')
    .onCreate(async (snap, context) => {
        if (!SENDGRID_KEY || !TEMPLATE_ID) {
            console.warn('Welcome Email Skipped: SendGrid not configured.');
            return null;
        }

        const userData = snap.data();
        const userId = context.params.userId;

        if (!userData.email) {
            console.warn(\`No email for user \${userId}\`);
            return null;
        }

        const cardUrl = \`https://id.simpli-fi-os.com/\${userId}\`;

        const msg = {
            to: userData.email,
            from: 'welcome@simpli-fi-os.com',
            templateId: TEMPLATE_ID,
            dynamicTemplateData: {
                full_name: userData.full_name || 'there',
                card_url: cardUrl,
                tier: (userData.tier || 'Ambassador').charAt(0).toUpperCase() + (userData.tier || 'ambassador').slice(1),
                login_url: 'https://dashboard.simpli-fi-os.com'
            }
        };

        try {
            await sgMail.send(msg);
            console.log(\`Welcome email sent to \${userData.email}\`);
            return null;
        } catch (error) {
            console.error('SendGrid Error:', error.response ? error.response.body : error);
            return null;
        }
    });`,

            src_utils: `/**
 * src/utils.js
 * Shared frontend utilities for Simpli-FI ID
 */

export const Utils = {

  formatPhone: (phone) => {
    if (!phone) return '';
    const digits = phone.replace(/\\D/g, '');
    if (digits.length === 10) {
      return \`(\${digits.slice(0,3)}) \${digits.slice(3,6)}-\${digits.slice(6)}\`;
    }
    if (digits.length === 11 && digits[0] === '1') {
      return \`(\${digits.slice(1,4)}) \${digits.slice(4,7)}-\${digits.slice(7)}\`;
    }
    return phone;
  },

  isValidEmail: (email) => {
    if (!email) return false;
    const re = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;
    return re.test(email.trim());
  },

  hasFeature: (tier, feature) => {
    const features = {
      ambassador: [],
      professional: ['save_contact', 'custom_colors', 'payment_link', 'booking_link'],
      founder: ['save_contact', 'custom_domain', 'resource_catalog', 'verified_badge', 'unlimited_updates'],
      enterprise: ['all']
    };
    tier = (tier || 'ambassador').toLowerCase();
    if (features[tier].includes('all')) return true;
    return features[tier].includes(feature);
  },

  generateVCard: (profile) => {
    if (!profile) return '';
    const lines = [
      'BEGIN:VCARD',
      'VERSION:3.0',
      \`N:\${profile.last_name || ''};\${profile.first_name || ''};;;\`,
      \`FN:\${profile.full_name || 'Simpli-FI User'}\`,
      profile.email ? \`EMAIL:\${profile.email}\` : '',
      profile.phone ? \`TEL:\${profile.phone}\` : '',
      profile.website ? \`URL:\${profile.website}\` : '',
      profile.title ? \`TITLE:\${profile.title}\` : '',
      profile.company ? \`ORG:\${profile.company}\` : '',
      'END:VCARD'
    ];
    return lines.filter(line => line).join('\\n');
  },

  sanitizeUrl: (url) => {
    if (!url) return '';
    if (!/^https?:\\/\\//i.test(url)) {
      return 'https://' + url;
    }
    return url;
  },

  celebrate: (tier = 'professional') => {
    console.log(\`üéâ Celebrating \${tier} tier activation!\`);
  }
};`,

            src_confetti: `/**
 * src/confettiManager.js
 * Tier-specific celebration effects using canvas-confetti
 */

import confetti from 'https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js';

const ConfettiManager = {
  isMobile: () => window.innerWidth < 768,
  baseCount: () => ConfettiManager.isMobile() ? 50 : 100,

  ambassador: () => {
    confetti({
      particleCount: ConfettiManager.baseCount() / 2,
      spread: 60,
      origin: { y: 0.6 },
      colors: ['#fbbf24', '#ffffff'],
      ticks: 200
    });
  },

  professional: () => {
    confetti({
      particleCount: ConfettiManager.baseCount(),
      spread: 70,
      origin: { y: 0.6 },
      colors: ['#fbbf24', '#1e293b', '#ffffff']
    });
  },

  founder: () => {
    const duration = 1500;
    const end = Date.now() + duration;

    const frame = () => {
      confetti({
        particleCount: 8,
        angle: 60,
        spread: 55,
        origin: { x: 0 },
        colors: ['#fbbf24', '#0d9488']
      });
      confetti({
        particleCount: 8,
        angle: 120,
        spread: 55,
        origin: { x: 1 },
        colors: ['#fbbf24', '#ffffff']
      });

      if (Date.now() < end) {
        requestAnimationFrame(frame);
      }
    };
    frame();
  },

  enterprise: () => {
    const count = ConfettiManager.baseCount() * 3;
    const defaults = {
      origin: { y: 0.6 },
      colors: ['#fbbf24', '#f59e0b', '#ffffff', '#1e293b', '#e11d48']
    };

    function fire(particleRatio, opts) {
      confetti({
        ...defaults,
        ...opts,
        particleCount: Math.floor(count * particleRatio)
      });
    }

    fire(0.25, { spread: 26, startVelocity: 55 });
    fire(0.2,  { spread: 60 });
    fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
    fire(0.1,  { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
    fire(0.1,  { spread: 120, startVelocity: 45 });
  },

  celebrate: (tier = 'professional') => {
    const normalizedTier = (tier || 'professional').toLowerCase();

    switch (normalizedTier) {
      case 'ambassador':
        ConfettiManager.ambassador();
        break;
      case 'professional':
        ConfettiManager.professional();
        break;
      case 'founder':
        ConfettiManager.founder();
        break;
      case 'enterprise':
        ConfettiManager.enterprise();
        break;
      default:
        ConfettiManager.professional();
    }
  }
};

if (typeof module !== 'undefined' && module.exports) {
  module.exports = ConfettiManager;
} else {
  window.ConfettiManager = ConfettiManager;
}`,

            src_vcard: `/**
 * src/vcardGenerator.js
 * Generates and downloads vCard (.vcf) for Professional+ tiers
 */

import { Utils } from './utils.js';

const VCardGenerator = {

  downloadVCard: (profile, tier = 'ambassador') => {
    if (!Utils.hasFeature(tier, 'save_contact')) {
      console.warn('vCard download blocked: Insufficient tier');
      return;
    }

    if (!profile || !profile.full_name) {
      console.warn('Cannot generate vCard: Missing profile data');
      return;
    }

    const vcard = VCardGenerator.buildVCard(profile);
    VCardGenerator.triggerDownload(vcard, profile);
  },

  buildVCard: (profile) => {
    const lines = [
      'BEGIN:VCARD',
      'VERSION:3.0',
      \`N:\${profile.last_name || ''};\${profile.first_name || ''};;;\`,
      \`FN:\${profile.full_name || 'Simpli-FI User'}\`
    ];

    if (profile.email) lines.push(\`EMAIL;TYPE=INTERNET:\${profile.email}\`);
    if (profile.phone) lines.push(\`TEL;TYPE=CELL:\${profile.phone}\`);
    if (profile.work_phone) lines.push(\`TEL;TYPE=WORK:\${profile.work_phone}\`);
    if (profile.website) lines.push(\`URL:\${Utils.sanitizeUrl(profile.website)}\`);
    if (profile.title) lines.push(\`TITLE:\${profile.title}\`);
    if (profile.company) lines.push(\`ORG:\${profile.company}\`);

    if (profile.address) {
      lines.push(\`ADR;TYPE=WORK:;;\${profile.address.street || ''};\${profile.address.city || ''};\${profile.address.state || ''};\${profile.address.zip || ''};\${profile.address.country || ''}\`);
    }

    if (profile.linkedin) lines.push(\`item1.URL:\${Utils.sanitizeUrl(profile.linkedin)}\`);
    if (profile.twitter) lines.push(\`item2.URL:\${Utils.sanitizeUrl(profile.twitter)}\`);

    if (profile.tagline) lines.push(\`NOTE:\${profile.tagline}\`);

    lines.push('END:VCARD');

    return lines.join('\\n');
  },

  triggerDownload: (vcardContent, profile) => {
    const filename = \`\${(profile.full_name || 'Simpli-FI_User').replace(/\\s+/g, '_')}.vcf\`;

    const blob = new Blob([vcardContent], { type: 'text/vcard;charset=utf-8' });
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.style.display = 'none';

    document.body.appendChild(a);
    a.click();

    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    if (typeof ConfettiManager !== 'undefined') {
      ConfettiManager.celebrate(profile.tier || 'professional');
    }
  }
};

if (typeof module !== 'undefined' && module.exports) {
  module.exports = VCardGenerator;
} else {
  window.VCardGenerator = VCardGenerator;
}`,

            scripts_deploy: `#!/usr/bin/env bash
# scripts/deploy-hosting.sh
set -euo pipefail

PROJECT_ID="simpli-fi-id"
PUBLIC_DIR="public"

command -v firebase >/dev/null 2>&1 || {
    echo "Firebase CLI not found. Install with: npm install -g firebase-tools"
    exit 1
}

if [[ ! -d "$PUBLIC_DIR" ]]; then
    echo "Error: Directory '$PUBLIC_DIR' not found"
    exit 1
fi

if [[ ! -f "firebase.json" ]]; then
    echo "Error: firebase.json not found"
    exit 1
fi

firebase login:list | grep -q "Logged in as" || firebase login
firebase use "$PROJECT_ID"

echo "Deploying to Firebase Hosting..."
firebase deploy --only hosting

echo "Deployment completed successfully!"`,

            scripts_env: `/**
 * scripts/setup-env.js
 * Creates .env from .env.example
 */

const fs = require('fs');
const path = require('path');

const ENV_EXAMPLE = '.env.example';
const ENV_LOCAL = '.env';
const ROOT_DIR = path.resolve(__dirname, '..');

const examplePath = path.join(ROOT_DIR, ENV_EXAMPLE);
const envPath = path.join(ROOT_DIR, ENV_LOCAL);

console.log('üîß Simpli-FI Environment Setup\\n');

if (!fs.existsSync(examplePath)) {
    console.error(\`‚ùå Error: \${ENV_EXAMPLE} not found.\`);
    process.exit(1);
}

if (fs.existsSync(envPath)) {
    console.log(\`‚ö†Ô∏è  \${ENV_LOCAL} already exists. Delete it first to recreate.\`);
    process.exit(0);
}

fs.copyFileSync(examplePath, envPath);

console.log(\`‚úÖ Created \${ENV_LOCAL} from \${ENV_EXAMPLE}\\n\`);
console.log('üìù Next: Edit .env with your keys\\n');
console.log('üîí NEVER commit .env to Git!\\n');
console.log('üöÄ Ready for development!');`,

            firestore_rules: `rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    function isSignedIn() {
      return request.auth != null;
    }
    
    function isOrgMember(orgId) {
      return isSignedIn() &&
             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.org_id == orgId;
    }

    function isServiceAccount() {
      return request.auth.token.firebase.sign_in_provider == 'firebase' &&
             request.auth.token.email.endsWith('@simpli-fi-id.iam.gserviceaccount.com');
    }

    match /users/{userId} {
      allow read, write: if isSignedIn() && request.auth.uid == userId;
      allow create, read: if isServiceAccount();
    }

    match /public_cards/{cardId} {
      allow read: if true;
      allow create, update: if isSignedIn() && request.auth.uid == request.resource.data.owner_uid;
      allow update: if isSignedIn() && resource.data.owner_uid == request.auth.uid;
    }

    match /organizations/{org
